/*******************************
 * Fichier : menu_parametres.gs
 *******************************/
function sauvegarderParametres(params) {
  var scriptProperties = PropertiesService.getScriptProperties();
  scriptProperties.setProperty('idDossier', params.idDossier);
  scriptProperties.setProperty('nomFichierInscriptions', params.nomFichierInscriptions);
  scriptProperties.setProperty('nomFichierArticles', params.nomFichierArticles);
  scriptProperties.setProperty('debugActif', params.debugActif ? "true" : "false");
  
  // Nouveaux paramètres booléens
  scriptProperties.setProperty('checkDuplicates', params.checkDuplicates ? "true" : "false");
  scriptProperties.setProperty('checkCDPConflict', params.checkCDPConflict ? "true" : "false");
  
  // Règles d’articles
  scriptProperties.setProperty('reglesArticles', JSON.stringify(params.reglesArticles));
  
  return "Paramètres sauvegardés avec succès.";
}

function getParametres() {
  var scriptProperties = PropertiesService.getScriptProperties();
  return {
    idDossier: scriptProperties.getProperty('idDossier') || '',
    nomFichierInscriptions: scriptProperties.getProperty('nomFichierInscriptions') || '',
    nomFichierArticles: scriptProperties.getProperty('nomFichierArticles') || '',
    debugActif: scriptProperties.getProperty('debugActif') === "true",
    
    checkDuplicates: scriptProperties.getProperty('checkDuplicates') === "true",
    checkCDPConflict: scriptProperties.getProperty('checkCDPConflict') === "true",
    
    reglesArticles: JSON.parse(scriptProperties.getProperty('reglesArticles') || '[]')
  };
}

/**
 * Récupère la liste unique des articles (colonne F) dans l'onglet "ARTICLES".
 * @return {string[]} Un tableau de noms d'articles uniques, triés par ordre alphabétique.
 */
function getListeArticlesUnique() {
  var ss = SpreadsheetApp.getActiveSpreadsheet();
  var sheetArticles = ss.getSheetByName("ARTICLES");
  if (!sheetArticles) {
    return [];
  }
  
  var lastRow = sheetArticles.getLastRow();
  if (lastRow < 2) {
    return [];
  }
  
  // Colonne F (index 5) => on part de la ligne 2 à lastRow
  var range = sheetArticles.getRange(2, 6, lastRow - 1, 1);
  var values = range.getValues();
  
  var articles = [];
  values.forEach(function(row) {
    var nom = row[0] ? row[0].toString().trim() : "";
    if (nom) {
      articles.push(nom);
    }
  });
  
  var uniqueArticles = Array.from(new Set(articles)).sort();
  return uniqueArticles;
}
